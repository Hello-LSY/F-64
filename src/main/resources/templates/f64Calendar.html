<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeaf-extras-springsecurity4">
<head>
    <meta charset="UTF-8">
    <title>F-64 Calendar</title>

    <!-- FullCalendar ÎùºÏù¥Î∏åÎü¨Î¶¨ -->
    <script src="/fullcalendar-6.1.5/dist/index.global.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- jQuery -->
    <script src="/js/jquery-3.6.4.js"></script>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');

            /** üìå FullCalendar Ï¥àÍ∏∞Ìôî */
            const calendar = new FullCalendar.Calendar(calendarEl, {
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                initialDate: new Date().toISOString().slice(0, 10),
                navLinks: true,
                selectable: true,
                selectMirror: true,
                editable: true,
                dayMaxEvents: true,

                /** üìå ÌñâÏÇ¨ ÏùºÏ†ï Ï∂îÍ∞Ä */
                select: function(arg) {
                    const title = prompt('ÌñâÏÇ¨ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
                    if (title) {
                        $.post("/calendar/event/add", {
                            title: title,
                            startDate: arg.start.toISOString(),
                            endDate: arg.end.toISOString(),
                            allDay: arg.allDay
                        }).done(function(response) {
                            calendar.addEvent({
                                id: response.id,
                                title: title,
                                start: arg.start,
                                end: arg.end,
                                allDay: arg.allDay
                            });
                        }).fail(function(xhr) {
                            alert("Error: " + xhr.responseText);
                        });
                    }
                    calendar.unselect();
                },

                /** üìå ÌñâÏÇ¨ ÏùºÏ†ï ÏÇ≠Ï†ú */
                eventClick: function(arg) {
                    if (confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                        $.ajax({
                            type: "DELETE",
                            url: "/calendar/event/delete/" + arg.event.id
                        }).done(function() {
                            arg.event.remove();
                        }).fail(function(xhr) {
                            alert("Error: " + xhr.responseText);
                        });
                    }
                }
            });

            /** üìå Í∏∞Ï°¥ ÌñâÏÇ¨ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ */
            $.get("/calendar/event/all")
                .done(function(events) {
                    events.forEach(event => {
                        calendar.addEvent({
                            id: event.id,
                            title: event.title,
                            start: event.startDate,
                            end: event.endDate,
                            allDay: event.allDay
                        });
                    });
                })
                .fail(function(xhr) {
                    alert("Error: " + xhr.responseText);
                });

            calendar.render();
        });
    </script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        #calendar {
            max-width: 1000px;
            margin: 0 auto;
            font-size: 14px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

<!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î -->
<div th:replace="layout/navbar :: fragment"></div>

<!-- Ï∫òÎ¶∞Îçî Ïª®ÌÖåÏù¥ÎÑà -->
<div class="max-w-6xl mx-auto p-8 mt-10 bg-white shadow-lg rounded-lg">
    <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">üìÖ ÌñâÏÇ¨ Ï∫òÎ¶∞Îçî</h1>
    <div id="calendar"></div>
</div>

</body>
</html>
