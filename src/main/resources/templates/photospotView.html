<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ì¶œì‚¬ì§€ ìƒì„¸ ë³´ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <!-- ì¹´ì¹´ì˜¤ë§µ SDK -->
  <script
          type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=dcc14e4ed8875f5829fe1274e43cee7b&libraries=services,drawing">
  </script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8fafc;
    }
    .map-container {
      height: 400px;
      width: 100%;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<div th:replace="layout/navbar :: fragment"></div>

<!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
<div class="max-w-5xl mx-auto p-6 bg-white shadow-lg rounded-lg mt-6">
  <h1 class="text-3xl font-bold text-gray-800 mb-6" th:text="${photoSpot.title}"></h1>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- ì§€ë„ ì˜ì—­ -->
    <div class="p-4 bg-gray-100 rounded-lg">
      <!-- pathListJsonì„ data-pathListì— ë°”ì¸ë”© -->
      <div id="map" class="map-container"
           th:attr="data-pathList=${photoSpot.pathListJson}">
      </div>
    </div>

    <!-- ì¶œì‚¬ì§€ ì •ë³´ -->
    <div class="p-6 bg-white rounded-lg shadow-md">
      <p class="text-gray-700 font-medium">
        <strong>ë‹‰ë„¤ì„:</strong>
        <span th:text="${photoSpot.userNickname}"></span>
      </p>
      <p class="text-gray-700 font-medium">
        <strong>ì¶œì‚¬ì¼:</strong>
        <span th:text="${photoSpot.date}"></span>
      </p>
      <hr class="my-4">
      <p class="text-gray-700"><strong>ì¶œì‚¬ì§€ ì„¤ëª…:</strong></p>
      <p class="text-gray-600" th:text="${photoSpot.description}"></p>

      <!-- ì‚­ì œ & ëª©ë¡ ë²„íŠ¼ -->
      <div class="mt-6 flex justify-end gap-3">
        <form id="delete-form"
              th:action="@{/photospot/delete/{id}(id=${photoSpot.id})}"
              method="post">
          <button type="button"
                  th:if="${isWriter}"
                  class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md shadow-md"
                  onclick="confirmDelete()">
            ğŸ—‘ï¸ ì‹ ì²­ ì‚­ì œ
          </button>
        </form>
        <a href="/photospot/list"
           class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md shadow-md">
          ğŸ”™ ëª©ë¡ìœ¼ë¡œ
        </a>
      </div>
    </div>
  </div>
</div>

<script>
  function confirmDelete() {
    if (confirm("ì‹ ì²­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      document.getElementById("delete-form").submit();
    }
  }

  // Kakao ì§€ë„ ì´ˆê¸°í™”
  kakao.maps.load(() => {
    var container = document.getElementById('map');
    var pathListJson = container.getAttribute("data-pathList");

    var pathList = [];
    try {
      pathList = JSON.parse(pathListJson); // JSON íŒŒì‹±
    } catch (e) {
      console.error("Invalid JSON for pathList:", e);
    }

    if (pathList.length === 0) {
      console.warn("No path coordinates available.");
      return;
    }

    var options = {
      center: new kakao.maps.LatLng(pathList[0].latitude, pathList[0].longitude),
      level: 7
    };
    var map = new kakao.maps.Map(container, options);

    // ë§ˆì»¤ ìœ„ì¹˜ ì¶”ê°€
    var bounds = new kakao.maps.LatLngBounds();
    var linePath = [];

    pathList.forEach(point => {
      if (!point.latitude || !point.longitude) return;
      let latLng = new kakao.maps.LatLng(point.latitude, point.longitude);
      linePath.push(latLng);
      bounds.extend(latLng);

      new kakao.maps.Marker({
        position: latLng,
        map: map
      });
    });

    // ê²½ë¡œ ë¼ì¸ ì¶”ê°€
    if (linePath.length > 1) {
      new kakao.maps.Polyline({
        path: linePath,
        strokeWeight: 5,
        strokeColor: "#FF5733",
        strokeOpacity: 0.8,
        strokeStyle: "solid",
        map: map
      });

      // ëª¨ë“  ë§ˆì»¤ê°€ ë³´ì´ë„ë¡ ì§€ë„ ì¡°ì •
      map.setBounds(bounds);
    }
  });
</script>

</body>
</html>
